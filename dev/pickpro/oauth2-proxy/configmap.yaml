apiVersion: v1
kind: ConfigMap
metadata:
  name: oauth2-proxy-config
  namespace: pickpro
data:
  oauth2_proxy.cfg: |
    provider = "oidc"
    oidc_issuer_url = "https://dev-logto.soludev.tech/oidc"
    
    redirect_url = "https://pickpro.soludev.tech/oauth2/callback"
    
    # Request additional user information
    scope = "openid email profile"
    
    # Map 'name' claim to preferred_username field
    oidc_preferred_username_claim = "name"
    
    # Force fetching from userinfo endpoint
    profile_url = "https://dev-logto.soludev.tech/oidc/me"
    
    # Cookie settings for cross-domain auth
    cookie_domains = [".soludev.tech"] 
    whitelist_domains = [".soludev.tech"]
    
    cookie_name = "oauth2-proxy-pickpro"
    email_domains = ["*"]
    
    upstreams = ["http://pickpro-front.pickpro.svc.cluster.local:5173"]
    http_address = "0.0.0.0:4180"
    reverse_proxy = true
    
    pass_access_token = true
    pass_authorization_header = true
    set_authorization_header = true
    pass_user_headers = true
    
    cookie_secure = true
    cookie_httponly = true
    cookie_path = "/"
    cookie_samesite = "lax" 
    cookie_refresh = "1h"
    cookie_csrf_per_request = false
    cookie_csrf_expire = "0s"
    
    skip_provider_button = true
    set_xauthrequest = true
    silence_ping_logging = true