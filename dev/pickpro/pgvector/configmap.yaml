apiVersion: v1
kind: ConfigMap
metadata:
  name: pgvector-init
  namespace: pickpro
data:
  init.sql: |
    CREATE TABLE IF NOT EXISTS "threads" (
        "id" UUID NOT NULL UNIQUE,
        "title" TEXT,
        "created_at" BIGINT,
        "user_id" TEXT,
        PRIMARY KEY("id")
    );




    CREATE TABLE IF NOT EXISTS "messages" (
        "id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
        "message" TEXT,
        "role" TEXT,
        "thread_id" UUID,
        "created_at" BIGINT,
        PRIMARY KEY("id")
    );




    CREATE TABLE IF NOT EXISTS "users" (
        "id" TEXT UNIQUE,
        "created_at" BIGINT,
        PRIMARY KEY("id")
    );



    ALTER TABLE "messages"
    ADD FOREIGN KEY("thread_id") REFERENCES "threads"("id")
    ON UPDATE NO ACTION ON DELETE CASCADE;
    ALTER TABLE "threads"
    ADD FOREIGN KEY("user_id") REFERENCES "users"("id")
    ON UPDATE NO ACTION ON DELETE NO ACTION;