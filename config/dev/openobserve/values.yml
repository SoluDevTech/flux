# values.yaml
# Pas de credentials en dur
auth:
  ZO_ROOT_USER_EMAIL: ""
  ZO_ROOT_USER_PASSWORD: ""
  ZO_S3_ACCESS_KEY: ""
  ZO_S3_SECRET_KEY: ""

# Injecter les credentials depuis le secret
extraEnv:
  - name: ZO_ROOT_USER_EMAIL
    valueFrom:
      secretKeyRef:
        name: soludev-openobserve-secret
        key: ZO_ROOT_USER_EMAIL
  - name: ZO_ROOT_USER_PASSWORD
    valueFrom:
      secretKeyRef:
        name: soludev-openobserve-secret
        key: ZO_ROOT_USER_PASSWORD
  - name: ZO_S3_ACCESS_KEY
    valueFrom:
      secretKeyRef:
        name: soludev-openobserve-secret
        key: MINIO_ACCESS
  - name: ZO_S3_SECRET_KEY
    valueFrom:
      secretKeyRef:
        name: soludev-openobserve-secret
        key: MINIO_SECRET
  - name: ZO_META_POSTGRES_DSN
    valueFrom:
      secretKeyRef:
        name: soludev-openobserve-secret
        key: ZO_META_POSTGRES_DSN
  
  # Configuration variables
  - name: ZO_META_STORE
    value: "postgres"
  - name: ZO_META_CONNECTION_POOL_MIN_SIZE
    value: "2"
  - name: ZO_META_CONNECTION_POOL_MAX_SIZE
    value: "10"
  - name: ZO_LOCAL_MODE
    value: "true"
  - name: ZO_LOCAL_MODE_STORAGE
    value: "s3"
  - name: ZO_S3_PROVIDER
    value: "minio"
  - name: ZO_S3_SERVER_URL
    value: "http://minio.soludev.svc.cluster.local:9000"
  - name: ZO_S3_REGION_NAME
    value: "us-east-1"
  - name: ZO_S3_BUCKET_NAME
    value: "observability"
  - name: ZO_S3_BUCKET_PREFIX
    value: ""
  - name: ZO_S3_FEATURE_FORCE_HOSTED_STYLE
    value: "false"
  - name: ZO_S3_FEATURE_FORCE_PATH_STYLE
    value: "true"
  - name: ZO_S3_FEATURE_HTTP1_ONLY
    value: "false"
  - name: ZO_S3_FEATURE_HTTP2_ONLY
    value: "false"
  - name: ZO_COMPACT_DATA_RETENTION_DAYS
    value: "10"
  - name: ZO_COMPACT_ENABLED
    value: "true"
  - name: ZO_COMPACT_INTERVAL
    value: "3600"
  # Reduce data latency - make data queryable faster
  - name: ZO_FILE_PUSH_INTERVAL
    value: "10"
  - name: ZO_MAX_FILE_RETENTION_TIME
    value: "60"
  - name: ZO_MEM_PERSIST_INTERVAL
    value: "1"
  # Enable memory cache for faster queries
  - name: ZO_MEMORY_CACHE_ENABLED
    value: "true"
  - name: ZO_MEMORY_CACHE_MAX_SIZE
    value: "512"
  - name: ZO_DISK_CACHE_ENABLED
    value: "true"
  - name: ZO_DISK_CACHE_MAX_SIZE
    value: "5000"
  - name: ZO_DISK_CACHE_GC_INTERVAL
    value: "30"
  - name: ZO_DISK_CACHE_GC_SIZE
    value: "500"
  - name: ZO_DISK_CACHE_STRATEGY
    value: "time_lru"
  - name: ZO_RESULT_CACHE_ENABLED
    value: "true"
  # Increase dashboard series limit
  - name: ZO_MAX_DASHBOARD_SERIES
    value: "500"

# NOTE: Config section is not used by this chart, all configuration is in extraEnv above
# Kept for documentation purposes only
config: {}

resources:
  limits:
    cpu: 1500m
    memory: 2Gi
  requests:
    cpu: 1000m
    memory: 1Gi

# Persistence temporaire pour cache local (les donn√©es sont dans MinIO)
persistence:
  enabled: true
  size: 5Gi
  storageClass: "nfs-soludev-openobserve"
  accessModes:
    - ReadWriteMany

service:
  type: ClusterIP
  http_port: 5080
  grpc_port: 5081

ingress:
  enabled: false

minio:
  enabled: false